function MediumEditor(t,e){"use strict";return this.init(t,e)}angular.module("mnd.multi-transclude",[]).directive("mndMultiTransclude",function(){return{link:function(t,e,n,i,o){if(!o)throw new Error("Illegal use of mndMultiTransculde");o(function(t){var i=angular.element("<div></div>");i.append(t);var o="[name="+n.mndMultiTransclude+"]",r=i[0].querySelector(o);r=angular.element(r),e.replaceWith(r)})}}}),angular.module("mnd.dashboard",["ui.bootstrap","mnd.multi-transclude"]).factory("MndSidebarService",function(){var t=!1;return{getSidebarStatus:function(){return t},toggleSidebarStatus:function(){t=!t}}}).directive("mndSidebar",["MndSidebarService",function(t){return{restrict:"EA",templateUrl:"template/sidebar.html",transclude:!0,scope:{menu:"="},link:function(e){e.isSubmenu=function(t){return"submenu"===t.type},e.toggleSubmenu=function(t){"submenu"===t.type&&(t.open=!t.open)},e.sidebarOpen=t.getSidebarStatus(),e.$on("sidebarStatusChanged",function(){e.sidebarOpen=t.getSidebarStatus()})}}}]).directive("mndToggleSidebar",["MndSidebarService",function(t){return{restrict:"EA",templateUrl:"template/toggle-sidebar.html",scope:{},link:function(e){e.sidebarOpen=t.getSidebarStatus(),e.toggle=function(){t.toggleSidebarStatus(),e.$parent.$broadcast("sidebarStatusChanged")},e.$on("sidebarStatusChanged",function(){e.sidebarOpen=t.getSidebarStatus()})}}}]).directive("mndContent",["MndSidebarService",function(t){return{restrict:"EA",templateUrl:"template/content.html",scope:{},transclude:!0,link:function(e){e.sidebarOpen=t.getSidebarStatus(),e.$on("sidebarStatusChanged",function(){e.sidebarOpen=t.getSidebarStatus()})}}}]),function(t){try{t=angular.module("mnd.dashboard")}catch(e){t=angular.module("mnd.dashboard",[])}t.run(["$templateCache",function(t){t.put("template/content.html",'<div id="mnd-content" ng-class="{\'sidebar-open\': sidebarOpen}" ng-transclude></div>\n')}])}(),function(t){try{t=angular.module("mnd.dashboard")}catch(e){t=angular.module("mnd.dashboard",[])}t.run(["$templateCache",function(t){t.put("template/sidebar.html",'<div id="mnd-sidebar" ng-class="{\'sidebar-open\': sidebarOpen}">\n	<div mnd-multi-transclude="before"></div>\n	<ul class="nav">\n		<li ng-repeat="item in menu.items" ng-click="toggleSubmenu(item)" class="mnd-clickable">\n			<a ng-href="{{item.href}}">\n				<span class="mnd-width-20" ng-if="item.icon">\n					<i class="fa {{item.icon}}"></i>\n				</span>\n				{{item.title}}\n				<span ng-if="isSubmenu(item)" class="pull-right">\n					<i ng-if="!item.open"class="fa fa-angle-left"></i>\n					<i ng-if="item.open"class="fa fa-angle-down"></i>\n				</span>\n			</a>\n			<ul ng-if="isSubmenu(item)" collapse="!item.open" class="nav nav-second-level">\n				<li ng-repeat="subitem in item.items">\n					<a ng-href="{{subitem.href}}">\n						<span class="mnd-width-20"></span>\n						<span class="mnd-width-20" ng-if="subitem.icon">\n							<i class="fa {{subitem.icon}}"></i>\n						</span>\n						{{subitem.title}}\n					</a>\n				</li>\n			</ul>\n		</li>\n	</ul>\n	<div mnd-multi-transclude="after">\n		<div id="mnd-sidebar-footer">\n			<span>\n				MONDORA Srl \n			</span>\n			<br />\n			Milano, Morbegno, Novara, St. Moritz (CH)<br />\n			Via Cornalia 7 <br />\n			20154, Milano <br />\n		</div>\n	</div>\n</div>\n')}])}(),function(t){try{t=angular.module("mnd.dashboard")}catch(e){t=angular.module("mnd.dashboard",[])}t.run(["$templateCache",function(t){t.put("template/toggle-sidebar.html",'<div id="mnd-toggle-sidebar" ng-class="{\'sidebar-open\': sidebarOpen}">\n	<div id="mnd-show-sidebar" ng-click="toggle()">\n		<i class="fa fa-bars" ng-show="!sidebarOpen"></i>\n		<i class="fa fa-times" ng-show="sidebarOpen"></i>\n	</div>\n	<div id="mnd-sidebar-logo">\n		<div class="mnd-mondora-logo">\n			<img src="http://mnd-website.s3.amazonaws.com/img/mondora-logo.png" />\n		</div>\n	</div>\n</div>\n')}])}(),angular.module("mnd.sprinkle",[]).factory("MndWordProcessingService",function(){return function(t){var e={};if(2===t.length)e.left=t[0],e.pivot=t[1],e.right="";else{var n=Math.ceil(t.length/2-1);e.left=t.slice(0,n),e.right=t.slice(n+1),e.pivot=t.slice(n,n+1)}return e.multiplier=/[\,\:\;]$/g.test(t)?1.5:/[\.\!\?]$/g.test(t)?2:1,e}}).factory("MndWordSplittingService",function(){return function(t){var e=t.split(/\s+/);return e}}).directive("mndSprinkle",["$timeout","MndWordSplittingService","MndWordProcessingService",function(t,e,n){return{restrict:"EA",templateUrl:"templates/sprinkle.html",scope:{text:"@",defaultWpm:"@?",autoplay:"@?",autoplayDelay:"@?",progressPercentage:"=?"},link:function(i){i._words=e(i.text),i._wordIndex=0,i._msPerWord=function(){return Math.floor(6e4/i.wpm)},i.increaseSpeed=function(t){var e=i.wpm;e+=t||50,i.wpm=e},i.decreaseSpeed=function(t){var e=i.wpm;e-=t||50,50>e&&(e=50),i.wpm=e},i.wpm=parseInt(i.defaultWpm||"250",10);var o=function(){var e=i._words[i._wordIndex],r=n(e);i.word=r;var a=r.multiplier*i._msPerWord();i._wordIndex++,i.progressPercentage=i._wordIndex/i._words.length*100,i._wordIndex<i._words.length?i._timeout=t(o,a):(i.running=!1,i._wordIndex=0)};if(i.running=!1,i.start=function(){i.running||(i.running=!0,o())},i.pause=function(){i.running&&(t.cancel(i._timeout),i.running=!1)},i.rewind=function(){i._wordIndex=0},i.stop=function(){i.pause(),i.rewind()},"true"===i.autoplay){var r=parseInt(i.autoplayDelay,10),a=isNaN(r)?0:r;t(function(){i.start()},1e3*a)}}}}]),function(t){try{t=angular.module("mnd.sprinkle")}catch(e){t=angular.module("mnd.sprinkle",[])}t.run(["$templateCache",function(t){t.put("templates/sprinkle.html",'<div class="sprinkle-container">\n	<div class="sprinkle-result">\n		\n		<span class="sprinkle-left">\n			&nbsp;\n			{{word.left}}\n		</span>\n		<span class="sprinkle-pivot">\n			<div class="sprinkle-center-line-top"></div>\n			<div class="sprinkle-center-line-center"></div>\n			<div class="sprinkle-center-line-bottom"></div>	\n			{{word.pivot}}\n		</span>\n		<span class="sprinkle-right">\n			{{word.right}}\n		</span>\n	</div>\n	<div class="sprinkle-control-bar">\n		<div class="sprinkle-control-bar-left">\n			<div class="sprinkle-control-btn" ng-click="rewind()"><i class="fa fa-refresh"></i></div>\n			<div class="sprinkle-control-btn" ng-if="running" ng-click="pause()"><i class="fa fa-pause"></i></div>\n			<div class="sprinkle-control-btn" ng-if="!running" ng-click="start()"><i class="fa fa-play"></i></div>\n		</div>\n		<div class="sprinkle-control-bar-right">\n			<div class="sprinkle-control-btn" ng-click="decreaseSpeed()"><i class="fa fa-minus"></i></div>\n			<div class="sprinkle-control-wpm">{{wpm}} wpm </div>\n			<div class="sprinkle-control-btn" ng-click="increaseSpeed()"><i class="fa fa-plus"></i></div>\n		</div>\n	</div>\n<br />\n<br />\n<br />\n\n</div>\n')}])}(),function(t){if("function"==typeof bootstrap)bootstrap("promise",t);else if("object"==typeof exports)module.exports=t();else if("function"==typeof define&&define.amd)define(t);else if("undefined"!=typeof ses){if(!ses.ok())return;ses.makeQ=t}else Q=t()}(function(){"use strict";function t(t){return function(){return z.apply(t,arguments)}}function e(t){return t===Object(t)}function n(t){return"[object StopIteration]"===ee(t)||t instanceof $}function i(t,e){if(B&&e.stack&&"object"==typeof t&&null!==t&&t.stack&&-1===t.stack.indexOf(ne)){for(var n=[],i=e;i;i=i.source)i.stack&&n.unshift(i.stack);n.unshift(t.stack);var r=n.join("\n"+ne+"\n");t.stack=o(r)}}function o(t){for(var e=t.split("\n"),n=[],i=0;i<e.length;++i){var o=e[i];s(o)||r(o)||!o||n.push(o)}return n.join("\n")}function r(t){return-1!==t.indexOf("(module.js:")||-1!==t.indexOf("(node.js:")}function a(t){var e=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(t);if(e)return[e[1],Number(e[2])];var n=/at ([^ ]+):(\d+):(?:\d+)$/.exec(t);if(n)return[n[1],Number(n[2])];var i=/.*@(.+):(\d+)$/.exec(t);return i?[i[1],Number(i[2])]:void 0}function s(t){var e=a(t);if(!e)return!1;var n=e[0],i=e[1];return n===F&&i>=U&&ae>=i}function c(){if(B)try{throw new Error}catch(t){var e=t.stack.split("\n"),n=e[0].indexOf("@")>0?e[1]:e[2],i=a(n);if(!i)return;return F=i[0],i[1]}}function u(t,e,n){return function(){return"undefined"!=typeof console&&"function"==typeof console.warn&&console.warn(e+" is deprecated, use "+n+" instead.",new Error("").stack),t.apply(t,arguments)}}function l(t){return b(t)?t:g(t)?T(t):L(t)}function d(){function t(t){e=t,r.source=t,Y(n,function(e,n){Q(function(){t.promiseDispatch.apply(t,n)})},void 0),n=void 0,i=void 0}var e,n=[],i=[],o=X(d.prototype),r=X(f.prototype);if(r.promiseDispatch=function(t,o,r){var a=V(arguments);n?(n.push(a),"when"===o&&r[1]&&i.push(r[1])):Q(function(){e.promiseDispatch.apply(e,a)})},r.valueOf=function(){if(n)return r;var t=v(e);return b(t)&&(e=t),t},r.inspect=function(){return e?e.inspect():{state:"pending"}},l.longStackSupport&&B)try{throw new Error}catch(a){r.stack=a.stack.substring(a.stack.indexOf("\n")+1)}return o.promise=r,o.resolve=function(n){e||t(l(n))},o.fulfill=function(n){e||t(L(n))},o.reject=function(n){e||t(C(n))},o.notify=function(t){e||Y(i,function(e,n){Q(function(){n(t)})},void 0)},o}function p(t){if("function"!=typeof t)throw new TypeError("resolver must be a function.");var e=d();try{t(e.resolve,e.reject,e.notify)}catch(n){e.reject(n)}return e.promise}function h(t){return p(function(e,n){for(var i=0,o=t.length;o>i;i++)l(t[i]).then(e,n)})}function f(t,e,n){void 0===e&&(e=function(t){return C(new Error("Promise does not support operation: "+t))}),void 0===n&&(n=function(){return{state:"unknown"}});var i=X(f.prototype);if(i.promiseDispatch=function(n,o,r){var a;try{a=t[o]?t[o].apply(i,r):e.call(i,o,r)}catch(s){a=C(s)}n&&n(a)},i.inspect=n,n){var o=n();"rejected"===o.state&&(i.exception=o.reason),i.valueOf=function(){var t=n();return"pending"===t.state||"rejected"===t.state?i:t.value}}return i}function m(t,e,n,i){return l(t).then(e,n,i)}function v(t){if(b(t)){var e=t.inspect();if("fulfilled"===e.state)return e.value}return t}function b(t){return e(t)&&"function"==typeof t.promiseDispatch&&"function"==typeof t.inspect}function g(t){return e(t)&&"function"==typeof t.then}function y(t){return b(t)&&"pending"===t.inspect().state}function _(t){return!b(t)||"fulfilled"===t.inspect().state}function w(t){return b(t)&&"rejected"===t.inspect().state}function k(){ie.length=0,oe.length=0,re||(re=!0)}function S(t,e){re&&(oe.push(t),ie.push(e&&"undefined"!=typeof e.stack?e.stack:"(no stack) "+e))}function A(t){if(re){var e=G(oe,t);-1!==e&&(oe.splice(e,1),ie.splice(e,1))}}function C(t){var e=f({when:function(e){return e&&A(this),e?e(t):this}},function(){return this},function(){return{state:"rejected",reason:t}});return S(e,t),e}function L(t){return f({when:function(){return t},get:function(e){return t[e]},set:function(e,n){t[e]=n},"delete":function(e){delete t[e]},post:function(e,n){return null===e||void 0===e?t.apply(void 0,n):t[e].apply(t,n)},apply:function(e,n){return t.apply(e,n)},keys:function(){return te(t)}},void 0,function(){return{state:"fulfilled",value:t}})}function T(t){var e=d();return Q(function(){try{t.then(e.resolve,e.reject,e.notify)}catch(n){e.reject(n)}}),e.promise}function x(t){return f({isDef:function(){}},function(e,n){return M(t,e,n)},function(){return l(t).inspect()})}function E(t,e,n){return l(t).spread(e,n)}function N(t){return function(){function e(t,e){var a;if("undefined"==typeof StopIteration){try{a=i[t](e)}catch(s){return C(s)}return a.done?a.value:m(a.value,o,r)}try{a=i[t](e)}catch(s){return n(s)?s.value:C(s)}return m(a,o,r)}var i=t.apply(this,arguments),o=e.bind(e,"next"),r=e.bind(e,"throw");return o()}}function R(t){l.done(l.async(t)())}function P(t){throw new $(t)}function O(t){return function(){return E([this,I(arguments)],function(e,n){return t.apply(e,n)})}}function M(t,e,n){return l(t).dispatch(e,n)}function I(t){return m(t,function(t){var e=0,n=d();return Y(t,function(i,o,r){var a;b(o)&&"fulfilled"===(a=o.inspect()).state?t[r]=a.value:(++e,m(o,function(i){t[r]=i,0===--e&&n.resolve(t)},n.reject,function(t){n.notify({index:r,value:t})}))},void 0),0===e&&n.resolve(t),n.promise})}function j(t){return m(t,function(t){return t=K(t,l),m(I(K(t,function(t){return m(t,J,J)})),function(){return t})})}function D(t){return l(t).allSettled()}function H(t,e){return l(t).then(void 0,void 0,e)}function q(t,e){return l(t).nodeify(e)}var B=!1;try{throw new Error}catch(W){B=!!W.stack}var F,$,U=c(),J=function(){},Q=function(){function t(){for(;e.next;){e=e.next;var n=e.task;e.task=void 0;var o=e.domain;o&&(e.domain=void 0,o.enter());try{n()}catch(a){if(r)throw o&&o.exit(),setTimeout(t,0),o&&o.enter(),a;setTimeout(function(){throw a},0)}o&&o.exit()}i=!1}var e={task:void 0,next:null},n=e,i=!1,o=void 0,r=!1;if(Q=function(t){n=n.next={task:t,domain:r&&process.domain,next:null},i||(i=!0,o())},"undefined"!=typeof process&&process.nextTick)r=!0,o=function(){process.nextTick(t)};else if("function"==typeof setImmediate)o="undefined"!=typeof window?setImmediate.bind(window,t):function(){setImmediate(t)};else if("undefined"!=typeof MessageChannel){var a=new MessageChannel;a.port1.onmessage=function(){o=s,a.port1.onmessage=t,t()};var s=function(){a.port2.postMessage(0)};o=function(){setTimeout(t,0),s()}}else o=function(){setTimeout(t,0)};return Q}(),z=Function.call,V=t(Array.prototype.slice),Y=t(Array.prototype.reduce||function(t,e){var n=0,i=this.length;if(1===arguments.length)for(;;){if(n in this){e=this[n++];break}if(++n>=i)throw new TypeError}for(;i>n;n++)n in this&&(e=t(e,this[n],n));return e}),G=t(Array.prototype.indexOf||function(t){for(var e=0;e<this.length;e++)if(this[e]===t)return e;return-1}),K=t(Array.prototype.map||function(t,e){var n=this,i=[];return Y(n,function(o,r,a){i.push(t.call(e,r,a,n))},void 0),i}),X=Object.create||function(t){function e(){}return e.prototype=t,new e},Z=t(Object.prototype.hasOwnProperty),te=Object.keys||function(t){var e=[];for(var n in t)Z(t,n)&&e.push(n);return e},ee=t(Object.prototype.toString);$="undefined"!=typeof ReturnValue?ReturnValue:function(t){this.value=t};var ne="From previous event:";l.resolve=l,l.nextTick=Q,l.longStackSupport=!1,l.defer=d,d.prototype.makeNodeResolver=function(){var t=this;return function(e,n){e?t.reject(e):t.resolve(arguments.length>2?V(arguments,1):n)}},l.Promise=p,l.promise=p,p.race=h,p.all=I,p.reject=C,p.resolve=l,l.passByCopy=function(t){return t},f.prototype.passByCopy=function(){return this},l.join=function(t,e){return l(t).join(e)},f.prototype.join=function(t){return l([this,t]).spread(function(t,e){if(t===e)return t;throw new Error("Can't join: not the same: "+t+" "+e)})},l.race=h,f.prototype.race=function(){return this.then(l.race)},l.makePromise=f,f.prototype.toString=function(){return"[object Promise]"},f.prototype.then=function(t,e,n){function o(e){try{return"function"==typeof t?t(e):e}catch(n){return C(n)}}function r(t){if("function"==typeof e){i(t,s);try{return e(t)}catch(n){return C(n)}}return C(t)}function a(t){return"function"==typeof n?n(t):t}var s=this,c=d(),u=!1;return Q(function(){s.promiseDispatch(function(t){u||(u=!0,c.resolve(o(t)))},"when",[function(t){u||(u=!0,c.resolve(r(t)))}])}),s.promiseDispatch(void 0,"when",[void 0,function(t){var e,n=!1;try{e=a(t)}catch(i){if(n=!0,!l.onerror)throw i;l.onerror(i)}n||c.notify(e)}]),c.promise},l.when=m,f.prototype.thenResolve=function(t){return this.then(function(){return t})},l.thenResolve=function(t,e){return l(t).thenResolve(e)},f.prototype.thenReject=function(t){return this.then(function(){throw t})},l.thenReject=function(t,e){return l(t).thenReject(e)},l.nearer=v,l.isPromise=b,l.isPromiseAlike=g,l.isPending=y,f.prototype.isPending=function(){return"pending"===this.inspect().state},l.isFulfilled=_,f.prototype.isFulfilled=function(){return"fulfilled"===this.inspect().state},l.isRejected=w,f.prototype.isRejected=function(){return"rejected"===this.inspect().state};var ie=[],oe=[],re=!0;l.resetUnhandledRejections=k,l.getUnhandledReasons=function(){return ie.slice()},l.stopUnhandledRejectionTracking=function(){k(),re=!1},k(),l.reject=C,l.fulfill=L,l.master=x,l.spread=E,f.prototype.spread=function(t,e){return this.all().then(function(e){return t.apply(void 0,e)},e)},l.async=N,l.spawn=R,l["return"]=P,l.promised=O,l.dispatch=M,f.prototype.dispatch=function(t,e){var n=this,i=d();return Q(function(){n.promiseDispatch(i.resolve,t,e)}),i.promise},l.get=function(t,e){return l(t).dispatch("get",[e])},f.prototype.get=function(t){return this.dispatch("get",[t])},l.set=function(t,e,n){return l(t).dispatch("set",[e,n])},f.prototype.set=function(t,e){return this.dispatch("set",[t,e])},l.del=l["delete"]=function(t,e){return l(t).dispatch("delete",[e])},f.prototype.del=f.prototype["delete"]=function(t){return this.dispatch("delete",[t])},l.mapply=l.post=function(t,e,n){return l(t).dispatch("post",[e,n])},f.prototype.mapply=f.prototype.post=function(t,e){return this.dispatch("post",[t,e])},l.send=l.mcall=l.invoke=function(t,e){return l(t).dispatch("post",[e,V(arguments,2)])},f.prototype.send=f.prototype.mcall=f.prototype.invoke=function(t){return this.dispatch("post",[t,V(arguments,1)])},l.fapply=function(t,e){return l(t).dispatch("apply",[void 0,e])},f.prototype.fapply=function(t){return this.dispatch("apply",[void 0,t])},l["try"]=l.fcall=function(t){return l(t).dispatch("apply",[void 0,V(arguments,1)])},f.prototype.fcall=function(){return this.dispatch("apply",[void 0,V(arguments)])},l.fbind=function(t){var e=l(t),n=V(arguments,1);return function(){return e.dispatch("apply",[this,n.concat(V(arguments))])}},f.prototype.fbind=function(){var t=this,e=V(arguments);return function(){return t.dispatch("apply",[this,e.concat(V(arguments))])}},l.keys=function(t){return l(t).dispatch("keys",[])},f.prototype.keys=function(){return this.dispatch("keys",[])},l.all=I,f.prototype.all=function(){return I(this)},l.allResolved=u(j,"allResolved","allSettled"),f.prototype.allResolved=function(){return j(this)},l.allSettled=D,f.prototype.allSettled=function(){return this.then(function(t){return I(K(t,function(t){function e(){return t.inspect()}return t=l(t),t.then(e,e)}))})},l.fail=l["catch"]=function(t,e){return l(t).then(void 0,e)},f.prototype.fail=f.prototype["catch"]=function(t){return this.then(void 0,t)},l.progress=H,f.prototype.progress=function(t){return this.then(void 0,void 0,t)},l.fin=l["finally"]=function(t,e){return l(t)["finally"](e)},f.prototype.fin=f.prototype["finally"]=function(t){return t=l(t),this.then(function(e){return t.fcall().then(function(){return e})},function(e){return t.fcall().then(function(){throw e})})},l.done=function(t,e,n,i){return l(t).done(e,n,i)},f.prototype.done=function(t,e,n){var o=function(t){Q(function(){if(i(t,r),!l.onerror)throw t;l.onerror(t)})},r=t||e||n?this.then(t,e,n):this;"object"==typeof process&&process&&process.domain&&(o=process.domain.bind(o)),r.then(void 0,o)},l.timeout=function(t,e,n){return l(t).timeout(e,n)},f.prototype.timeout=function(t,e){var n=d(),i=setTimeout(function(){n.reject(new Error(e||"Timed out after "+t+" ms"))},t);return this.then(function(t){clearTimeout(i),n.resolve(t)},function(t){clearTimeout(i),n.reject(t)},n.notify),n.promise},l.delay=function(t,e){return void 0===e&&(e=t,t=void 0),l(t).delay(e)},f.prototype.delay=function(t){return this.then(function(e){var n=d();return setTimeout(function(){n.resolve(e)},t),n.promise})},l.nfapply=function(t,e){return l(t).nfapply(e)},f.prototype.nfapply=function(t){var e=d(),n=V(t);return n.push(e.makeNodeResolver()),this.fapply(n).fail(e.reject),e.promise},l.nfcall=function(t){var e=V(arguments,1);return l(t).nfapply(e)},f.prototype.nfcall=function(){var t=V(arguments),e=d();return t.push(e.makeNodeResolver()),this.fapply(t).fail(e.reject),e.promise},l.nfbind=l.denodeify=function(t){var e=V(arguments,1);return function(){var n=e.concat(V(arguments)),i=d();return n.push(i.makeNodeResolver()),l(t).fapply(n).fail(i.reject),i.promise}},f.prototype.nfbind=f.prototype.denodeify=function(){var t=V(arguments);return t.unshift(this),l.denodeify.apply(void 0,t)},l.nbind=function(t,e){var n=V(arguments,2);return function(){function i(){return t.apply(e,arguments)}var o=n.concat(V(arguments)),r=d();return o.push(r.makeNodeResolver()),l(i).fapply(o).fail(r.reject),r.promise}},f.prototype.nbind=function(){var t=V(arguments,0);return t.unshift(this),l.nbind.apply(void 0,t)},l.nmapply=l.npost=function(t,e,n){return l(t).npost(e,n)},f.prototype.nmapply=f.prototype.npost=function(t,e){var n=V(e||[]),i=d();return n.push(i.makeNodeResolver()),this.dispatch("post",[t,n]).fail(i.reject),i.promise},l.nsend=l.nmcall=l.ninvoke=function(t,e){var n=V(arguments,2),i=d();return n.push(i.makeNodeResolver()),l(t).dispatch("post",[e,n]).fail(i.reject),i.promise},f.prototype.nsend=f.prototype.nmcall=f.prototype.ninvoke=function(t){var e=V(arguments,1),n=d();return e.push(n.makeNodeResolver()),this.dispatch("post",[t,e]).fail(n.reject),n.promise},l.nodeify=q,f.prototype.nodeify=function(t){return t?void this.then(function(e){Q(function(){t(null,e)})},function(e){Q(function(){t(e)})}):this};var ae=c();return l}),function(t,e){"function"==typeof define&&define.amd?define(e):"object"==typeof exports?module.exports=e():t.DDP=e()}(this,function(){"use strict";var t=function(){var t=0;return function(){return(t++).toString()}}(),e='{"server_id":"0"}',n=10,i=500,o=["added","changed","connected","error","failed","nosub","ready","removed","result","updated"],r=function(t){this._endpoint=t.endpoint,this._SocketConstructor=t.SocketConstructor,this._autoreconnect=!t.do_not_autoreconnect,this._debug=t.debug,this._onReadyCallbacks={},this._onResultCallbacks={},this._onUpdatedCallbacks={},this._events={},this._reconnect_count=0,this._reconnect_incremental_timer=0,t.do_not_autoconnect||this.connect()};return r.prototype.constructor=r,r.prototype.connect=function(){this._socket=new this._SocketConstructor(this._endpoint),this._socket.onopen=this._on_socket_open.bind(this),this._socket.onmessage=this._on_socket_message.bind(this),this._socket.onerror=this._on_socket_error.bind(this),this._socket.onclose=this._on_socket_close.bind(this)},r.prototype.method=function(e,n,i,o){var r=t();this._onResultCallbacks[r]=i,this._onUpdatedCallbacks[r]=o,this._send({msg:"method",id:r,method:e,params:n})},r.prototype.sub=function(e,n,i){var o=t();this._onReadyCallbacks[o]=i,this._send({msg:"sub",id:o,name:e,params:n})},r.prototype.unsub=function(t){this._send({msg:"unsub",id:t})},r.prototype.on=function(t,e){this._events[t]=this._events[t]||[],this._events[t].push(e)},r.prototype.off=function(t,e){this._events[t]&&this._events[t].splice(this._events[t].indexOf(e),1)},r.prototype._emit=function(t){if(this._events[t]){var e=arguments,n=this;this._events[t].forEach(function(t){t.apply(n,Array.prototype.slice.call(e,1))})}},r.prototype._send=function(t){var e;e="undefined"==typeof EJSON?JSON.stringify(t):EJSON.stringify(t),this._socket.send(e)},r.prototype._try_reconnect=function(){this._reconnect_count<n&&setTimeout(this.connect.bind(this),this._reconnect_incremental_timer),this._reconnect_count+=1,this._reconnect_incremental_timer+=i*this._reconnect_count},r.prototype._on_result=function(t){if(this._onResultCallbacks[t.id])this._onResultCallbacks[t.id](t.error,t.result),delete this._onResultCallbacks[t.id],t.error&&delete this._onUpdatedCallbacks[t.id];else if(t.error)throw delete this._onUpdatedCallbacks[t.id],t.error},r.prototype._on_updated=function(t){var e=this;t.methods.forEach(function(t){e._onUpdatedCallbacks[t]&&(e._onUpdatedCallbacks[t](),delete e._onUpdatedCallbacks[t])})},r.prototype._on_nosub=function(t){if(!this._onReadyCallbacks[t.id])throw t.error;this._onReadyCallbacks[t.id](t.error,t.id),delete this._onReadyCallbacks[t.id]},r.prototype._on_ready=function(t){var e=this;t.subs.forEach(function(t){e._onReadyCallbacks[t]&&(e._onReadyCallbacks[t](null,t),delete e._onReadyCallbacks[t])})},r.prototype._on_error=function(t){this._emit("error",t)},r.prototype._on_connected=function(t){this._reconnect_count=0,this._reconnect_incremental_timer=0,this._emit("connected",t)},r.prototype._on_failed=function(t){this._emit("failed",t)},r.prototype._on_added=function(t){this._emit("added",t)},r.prototype._on_removed=function(t){this._emit("removed",t)},r.prototype._on_changed=function(t){this._emit("changed",t)},r.prototype._on_socket_close=function(){this._emit("socket_close"),this._autoreconnect&&this._try_reconnect()},r.prototype._on_socket_error=function(t){this._emit("socket_error",t),this._autoreconnect&&this._try_reconnect()},r.prototype._on_socket_open=function(){this._send({msg:"connect",version:"pre1",support:["pre1"]})},r.prototype._on_socket_message=function(t){var n;if(this._debug&&console.log(t),t.data!==e){try{if(n="undefined"==typeof EJSON?JSON.parse(t.data):EJSON.parse(t.data),-1===o.indexOf(n.msg))throw new Error}catch(i){return console.warn("Non DDP message received:"),void console.warn(t.data)}this["_on_"+n.msg](n)}},r}),function(t,e){"function"==typeof define&&define.amd?define(e):"object"==typeof exports?module.exports=e():t.Asteroid=e()}(this,function(){"use strict";function t(t){return null===t?null:JSON.parse(JSON.stringify(t))}function e(t){var e="";for(var n in t)e+=n+"="+t[n]+"&";return e=e.slice(0,-1)}function n(){for(var t="",e=0;8>e;e++)t+=Math.floor(65536*(1+Math.random())).toString(16).substring(1);return t}function i(t,e){var n=JSON.stringify(t),i=JSON.stringify(e);return n===i}var o=function(){};o.prototype={constructor:o,_events:{},on:function(t,e){this._events[t]=this._events[t]||[],this._events[t].push(e)},off:function(t,e){this._events[t]&&this._events[t].splice(this._events[t].indexOf(e),1)},_emit:function(t){if(this._events[t]){var e=arguments,n=this;this._events[t].forEach(function(t){t.apply(n,Array.prototype.slice.call(e,1))})}}};var r=function(t){this._host=t.host,this._ddpOptions=t.ddpOptions,this._ddpOptions.do_not_autoconnect=!0,this._do_not_autocreate_collections=t._do_not_autocreate_collections,this.collections={},this._init()};r.prototype=new o,r.prototype.constructor=r,r.prototype._init=function(){var t=this;t.ddp=new DDP(this._ddpOptions),t.ddp.on("connected",function(){t._tryResumeLogin(),t.ddp.sub("meteor.loginServiceConfiguration"),t._emit("connected")}),t.ddp.on("added",t._onAdded.bind(t)),t.ddp.on("changed",t._onChanged.bind(t)),t.ddp.on("removed",t._onRemoved.bind(t)),t.ddp.connect()},r.prototype._onAdded=function(t){var e="meteor_accounts_loginServiceConfiguration",n=t.collection;if(!this.collections[n]){if(this._do_not_autocreate_collections&&n!==e&&"users"!==n)return;new r.Collection(n,this,r.DumbDb)}var i=t.fields||{};i._id=t.id,this.collections[n]._localInsert(i,!0)},r.prototype._onRemoved=function(t){this.collections[t.collection]&&this.collections[t.collection]._localRemove(t.id)},r.prototype._onChanged=function(t){this.collections[t.collection]&&(t.cleared&&t.cleared.forEach(function(e){t.fields[e]=void 0}),this.collections[t.collection]._localUpdate(t.id,t.fields))},r.prototype.subscribe=function(t){var e=Q.defer(),n=Array.prototype.slice.call(arguments,1);return this.ddp.sub(t,n,function(t,n){t?e.reject(t,n):e.resolve(n)}),e.promise},r.prototype.unsubscribe=function(t){this.ddp.unsub(t)},r.prototype.call=function(t){var e=Array.prototype.slice.call(arguments,1);return this.apply(t,e)},r.prototype.apply=function(t,e){var n=Q.defer(),i=Q.defer(),o=function(t,e){t?(n.reject(t),i.reject()):n.resolve(e)},r=function(){i.resolve()};return this.ddp.method(t,e,o,r),[n.promise,i.promise]};var a=function(t,e,n){this.name=t,this.asteroid=e,this.asteroid.collections[t]=this,this.db=new n};a.prototype=new o,a.prototype.constructor=a,a.prototype._localInsert=function(t,e){var n=this.db.get(t._id);if(!e||!i(n,t)){if(!e&&n)throw new Error("Item exists.");this.db.set(t._id,t),this._emit("change")}},a.prototype._remoteInsert=function(t){var e=this,n="/"+e.name+"/insert";this.asteroid.ddp.method(n,[t],function(n){if(n)throw e._localRemove(t._id),n})},a.prototype.insert=function(t){return t._id||(t._id=n()),this._localInsert(t,!1),this._remoteInsert(t),t._id};var s="__del__";a.prototype._localRemove=function(t){var e=this.db.get(t);return e?(this.db.del(t),this.db.del(t+s),void this._emit("change")):void console.warn("Item not present.")},a.prototype._localRestoreRemoved=function(t){var e=this.db.get(t+s);this.db.set(t,e),this.db.del(t+s),this._emit("change")},a.prototype._localMarkForRemoval=function(t){var e=this.db.get(t);return e?(this.db.set(t+s,e),this.db.del(t),void this._emit("change")):void console.warn("Item not present.")},a.prototype._remoteRemove=function(t){var e=this,n="/"+e.name+"/remove";this.asteroid.ddp.method(n,[{_id:t}],function(n){if(n)throw e._localRestoreRemoved(t),n})},a.prototype.remove=function(t){this._localMarkForRemoval(t),this._remoteRemove(t)};var c="__upd__";a.prototype._localUpdate=function(t,e){var n=this.db.get(t);if(!n)return void console.warn("Item not present.");for(var i in e)n[i]=e[i];this.db.set(t,n),this.db.del(t+c),this._emit("change")},a.prototype._localRestoreUpdated=function(t){var e=this.db.get(t+c);this.db.set(t,e),this.db.del(t+c),this._emit("change")},a.prototype._localMarkForUpdate=function(t,e){var n=this.db.get(t);return n?(this.db.set(t+c,n),this.db.set(t,e),void this._emit("change")):void console.warn("Item not present.")},a.prototype._remoteUpdate=function(t,e){var n=this,i="/"+n.name+"/update";this.asteroid.ddp.method(i,[{_id:t},{$set:e}],function(e){if(e)throw n._localRestoreUpdated(t),e})},a.prototype.update=function(t,e){this._localMarkForUpdate(t,e),this._remoteUpdate(t,e)},r.Collection=a;var u=function(){this.itemsHash={},this.itemsArray=[]};return u.prototype.set=function(t,e){this.itemsHash[t]=e,this.itemsArray.push(e)},u.prototype.get=function(e){return this.itemsHash[e]?t(this.itemsHash[e]):void 0},u.prototype.del=function(t){if(this.itemsHash[t]){var e=this.itemsArray.indexOf(this.itemsHash[t]);this.itemsArray.splice(e,1),delete this.itemsHash[t]}},u.prototype.ls=function(){return t(this.itemsArray)},r.DumbDb=u,r.prototype._getOauthClientId=function(t){var e="meteor_accounts_loginServiceConfiguration",n=this.collections[e].db.itemsArray,i="";return n.forEach(function(e){e.service===t&&("facebook"===t&&(i=e.appId),"google"===t&&(i=e.clientId),"github"===t&&(i=e.clientId),"twitter"===t&&(i=e.consumerKey))}),i},r.prototype._initOauthLogin=function(t,e,n){var i=this;return Q().then(function(){var t=Q.defer(),e=window.open(n,"Login");e.focus&&e.focus();var i=setInterval(function(){(e.closed||void 0===e.closed)&&(clearInterval(i),t.resolve())},100);return t.promise}).then(function(){var t=Q.defer(),n={oauth:{credentialToken:e}};return i.ddp.method("login",[n],function(e,n){return e?t.reject():(i.userId=n.id,localStorage[i._host+"__login_token__"]=n.token,i._emit("login",n),void t.resolve(n.id))}),t.promise})},r.prototype._tryResumeLogin=function(){var t=this,e=localStorage[t._host+"__login_token__"];return e?Q().then(function(){var n=Q.defer(),i={resume:e};return t.ddp.method("login",[i],function(e,i){return e?n.reject():(t.userId=i.id,localStorage[t._host+"__login_token__"]=i.token,t._emit("login",i),void n.resolve(i.id))}),n.promise}).fail(function(){t.userId=null,delete localStorage[t._host+"__login_token__"],t._emit("logout")}):void 0},r.prototype.loginWithFacebook=function(t){var i=n(),o={client_id:this._getOauthClientId("facebook"),redirect_uri:this._host+"/_oauth/facebook?close",state:i,scope:t||"email"},r="https://www.facebook.com/dialog/oauth?"+e(o);return this._initOauthLogin("facebook",i,r)},r.prototype.loginWithGoogle=function(t){var i=n(),o={response_type:"code",client_id:this._getOauthClientId("google"),redirect_uri:this._host+"/_oauth/google?close",state:i,scope:t||"openid email"},r="https://accounts.google.com/o/oauth2/auth?"+e(o);return this._initOauthLogin("google",i,r)},r.prototype.loginWithGithub=function(t){var i=n(),o={client_id:this._getOauthClientId("github"),redirect_uri:this._host+"/_oauth/github?close",state:i,scope:t||"email"},r="https://github.com/login/oauth/authorize?"+e(o);return this._initOauthLogin("github",i,r)},r.prototype.loginWithTwitter=function(){var t=n(),i=this._host+"/_oauth/twitter?close&state="+t,o={requestTokenAndRedirect:encodeURIComponent(i),state:t},r=this._host+"/_oauth/twitter/?"+e(o);
return this._initOauthLogin("twitter",t,r)},r.prototype.logout=function(){},r}),angular.module("asteroid",[]).factory("$collection",function(t){return function(e){var n={},i=function(t){return JSON.parse(JSON.stringify(t))},o=function(){n.array=i(e.db.itemsArray),n.hash=i(e.db.itemsHash)};return e.on("change",function(){t(o,0)}),o(),n}}),"object"==typeof module&&(module.exports=MediumEditor),function(t,e){"use strict";function n(t,e){var n;if(void 0===t)return e;for(n in e)e.hasOwnProperty(n)&&t.hasOwnProperty(n)===!1&&(t[n]=e[n]);return t}function i(){var e,n,i,o=t.getSelection();if(o.getRangeAt&&o.rangeCount){for(i=[],e=0,n=o.rangeCount;n>e;e+=1)i.push(o.getRangeAt(e));return i}return null}function o(e){var n,i,o=t.getSelection();if(e)for(o.removeAllRanges(),n=0,i=e.length;i>n;n+=1)o.addRange(e[n])}function r(){var t=e.getSelection().anchorNode,n=t&&3===t.nodeType?t.parentNode:t;return n}function a(){var n,i,o,r,a="";if(void 0!==t.getSelection){if(i=t.getSelection(),i.rangeCount){for(r=e.createElement("div"),n=0,o=i.rangeCount;o>n;n+=1)r.appendChild(i.getRangeAt(n).cloneContents());a=r.innerHTML}}else void 0!==e.selection&&"Text"===e.selection.type&&(a=e.selection.createRange().htmlText);return a}function s(t){return!(!t||1!==t.nodeType)}MediumEditor.prototype={defaults:{allowMultiParagraphSelection:!0,anchorInputPlaceholder:"Paste or type a link",anchorPreviewHideDelay:500,buttons:["bold","italic","underline","anchor","header1","header2","quote"],buttonLabels:!1,checkLinkFormat:!1,cleanPastedHTML:!1,delay:0,diffLeft:0,diffTop:-10,disableReturn:!1,disableDoubleReturn:!1,disableToolbar:!1,firstHeader:"h3",forcePlainText:!0,placeholder:"Type your text",secondHeader:"h4",targetBlank:!1,extensions:{}},isIE:"Microsoft Internet Explorer"===navigator.appName||"Netscape"===navigator.appName&&null!==new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})").exec(navigator.userAgent),init:function(t,i){return this.elements="string"==typeof t?e.querySelectorAll(t):t,1===this.elements.nodeType&&(this.elements=[this.elements]),0!==this.elements.length?(this.parentElements=["p","h1","h2","h3","h4","h5","h6","blockquote","pre"],this.id=e.querySelectorAll(".medium-editor-toolbar").length+1,this.options=n(i,this.defaults),this.setup()):void 0},setup:function(){this.isActive=!0,this.initElements().bindSelect().bindPaste().setPlaceholders().bindWindowActions()},initElements:function(){var t,e=!1;for(t=0;t<this.elements.length;t+=1)this.elements[t].setAttribute("contentEditable",!0),this.elements[t].getAttribute("data-placeholder")||this.elements[t].setAttribute("data-placeholder",this.options.placeholder),this.elements[t].setAttribute("data-medium-element",!0),this.bindParagraphCreation(t).bindReturn(t).bindTab(t),this.options.disableToolbar||this.elements[t].getAttribute("data-disable-toolbar")||(e=!0);return e&&this.initToolbar().bindButtons().bindAnchorForm().bindAnchorPreview(),this},serialize:function(){var t,e,n={};for(t=0;t<this.elements.length;t+=1)e=""!==this.elements[t].id?this.elements[t].id:"element-"+t,n[e]={value:this.elements[t].innerHTML.trim()};return n},callExtensions:function(t){if(!(arguments.length<1)){var e,n,i=Array.prototype.slice.call(arguments,1);for(n in this.options.extensions)this.options.extensions.hasOwnProperty(n)&&(e=this.options.extensions[n],void 0!==e[t]&&e[t].apply(e,i))}},bindParagraphCreation:function(t){var n=this;return this.elements[t].addEventListener("keyup",function(t){var i,o=r();o&&o.getAttribute("data-medium-element")&&0===o.children.length&&!n.options.disableReturn&&!o.getAttribute("data-disable-return")&&e.execCommand("formatBlock",!1,"p"),13===t.which&&(o=r(),i=o.tagName.toLowerCase(),n.options.disableReturn||this.getAttribute("data-disable-return")||"li"===i||n.isListItemChild(o)||(t.shiftKey||e.execCommand("formatBlock",!1,"p"),"a"===i&&e.execCommand("unlink",!1,null)))}),this},isListItemChild:function(t){for(var e=t.parentNode,n=e.tagName.toLowerCase();-1===this.parentElements.indexOf(n)&&"div"!==n;){if("li"===n)return!0;if(e=e.parentNode,!e||!e.tagName)return!1;n=e.tagName.toLowerCase()}return!1},bindReturn:function(t){var e=this;return this.elements[t].addEventListener("keypress",function(t){if(13===t.which)if(e.options.disableReturn||this.getAttribute("data-disable-return"))t.preventDefault();else if(e.options.disableDoubleReturn||this.getAttribute("data-disable-double-return")){var n=r();n&&"\n"===n.innerText&&t.preventDefault()}}),this},bindTab:function(t){return this.elements[t].addEventListener("keydown",function(t){if(9===t.which){var n=r().tagName.toLowerCase();"pre"===n&&(t.preventDefault(),e.execCommand("insertHtml",null,"    "))}}),this},buttonTemplate:function(t){var e=this.getButtonLabels(this.options.buttonLabels),n={bold:'<button class="medium-editor-action medium-editor-action-bold" data-action="bold" data-element="b">'+e.bold+"</button>",italic:'<button class="medium-editor-action medium-editor-action-italic" data-action="italic" data-element="i">'+e.italic+"</button>",underline:'<button class="medium-editor-action medium-editor-action-underline" data-action="underline" data-element="u">'+e.underline+"</button>",strikethrough:'<button class="medium-editor-action medium-editor-action-strikethrough" data-action="strikethrough" data-element="strike"><strike>A</strike></button>',superscript:'<button class="medium-editor-action medium-editor-action-superscript" data-action="superscript" data-element="sup">'+e.superscript+"</button>",subscript:'<button class="medium-editor-action medium-editor-action-subscript" data-action="subscript" data-element="sub">'+e.subscript+"</button>",anchor:'<button class="medium-editor-action medium-editor-action-anchor" data-action="anchor" data-element="a">'+e.anchor+"</button>",image:'<button class="medium-editor-action medium-editor-action-image" data-action="image" data-element="img">'+e.image+"</button>",header1:'<button class="medium-editor-action medium-editor-action-header1" data-action="append-'+this.options.firstHeader+'" data-element="'+this.options.firstHeader+'">'+e.header1+"</button>",header2:'<button class="medium-editor-action medium-editor-action-header2" data-action="append-'+this.options.secondHeader+'" data-element="'+this.options.secondHeader+'">'+e.header2+"</button>",quote:'<button class="medium-editor-action medium-editor-action-quote" data-action="append-blockquote" data-element="blockquote">'+e.quote+"</button>",orderedlist:'<button class="medium-editor-action medium-editor-action-orderedlist" data-action="insertorderedlist" data-element="ol">'+e.orderedlist+"</button>",unorderedlist:'<button class="medium-editor-action medium-editor-action-unorderedlist" data-action="insertunorderedlist" data-element="ul">'+e.unorderedlist+"</button>",pre:'<button class="medium-editor-action medium-editor-action-pre" data-action="append-pre" data-element="pre">'+e.pre+"</button>",indent:'<button class="medium-editor-action medium-editor-action-indent" data-action="indent" data-element="ul">'+e.indent+"</button>",outdent:'<button class="medium-editor-action medium-editor-action-outdent" data-action="outdent" data-element="ul">'+e.outdent+"</button>"};return n[t]||!1},getButtonLabels:function(t){var e,n,i={bold:"<b>B</b>",italic:"<b><i>I</i></b>",underline:"<b><u>U</u></b>",superscript:"<b>x<sup>1</sup></b>",subscript:"<b>x<sub>1</sub></b>",anchor:"<b>#</b>",image:"<b>image</b>",header1:"<b>H1</b>",header2:"<b>H2</b>",quote:"<b>&ldquo;</b>",orderedlist:"<b>1.</b>",unorderedlist:"<b>&bull;</b>",pre:"<b>0101</b>",indent:"<b>&rarr;</b>",outdent:"<b>&larr;</b>"};if("fontawesome"===t?e={bold:'<i class="fa fa-bold"></i>',italic:'<i class="fa fa-italic"></i>',underline:'<i class="fa fa-underline"></i>',superscript:'<i class="fa fa-superscript"></i>',subscript:'<i class="fa fa-subscript"></i>',anchor:'<i class="fa fa-link"></i>',image:'<i class="fa fa-picture-o"></i>',quote:'<i class="fa fa-quote-right"></i>',orderedlist:'<i class="fa fa-list-ol"></i>',unorderedlist:'<i class="fa fa-list-ul"></i>',pre:'<i class="fa fa-code fa-lg"></i>',indent:'<i class="fa fa-indent"></i>',outdent:'<i class="fa fa-outdent"></i>'}:"object"==typeof t&&(e=t),"object"==typeof e)for(n in e)e.hasOwnProperty(n)&&(i[n]=e[n]);return i},initToolbar:function(){return this.toolbar?this:(this.toolbar=this.createToolbar(),this.keepToolbarAlive=!1,this.anchorForm=this.toolbar.querySelector(".medium-editor-toolbar-form-anchor"),this.anchorInput=this.anchorForm.querySelector("input"),this.toolbarActions=this.toolbar.querySelector(".medium-editor-toolbar-actions"),this.anchorPreview=this.createAnchorPreview(),this)},createToolbar:function(){var t=e.createElement("div");return t.id="medium-editor-toolbar-"+this.id,t.className="medium-editor-toolbar",t.appendChild(this.toolbarButtons()),t.appendChild(this.toolbarFormAnchor()),e.body.appendChild(t),t},toolbarButtons:function(){var t,n,i,o,r=this.options.buttons,a=e.createElement("ul");for(a.id="medium-editor-toolbar-actions",a.className="medium-editor-toolbar-actions clearfix",n=0;n<r.length;n+=1)this.options.extensions.hasOwnProperty(r[n])?(o=this.options.extensions[r[n]],i=void 0!==o.getButton?o.getButton():null):i=this.buttonTemplate(r[n]),i&&(t=e.createElement("li"),s(i)?t.appendChild(i):t.innerHTML=i,a.appendChild(t));return a},toolbarFormAnchor:function(){var t=e.createElement("div"),n=e.createElement("input"),i=e.createElement("a");return i.setAttribute("href","#"),i.innerHTML="&times;",n.setAttribute("type","text"),n.setAttribute("placeholder",this.options.anchorInputPlaceholder),t.className="medium-editor-toolbar-form-anchor",t.id="medium-editor-toolbar-form-anchor",t.appendChild(n),t.appendChild(i),t},bindSelect:function(){var t,n=this,i="";for(this.checkSelectionWrapper=function(t){return t&&n.clickingIntoArchorForm(t)?!1:(clearTimeout(i),void(i=setTimeout(function(){n.checkSelection()},n.options.delay)))},e.documentElement.addEventListener("mouseup",this.checkSelectionWrapper),t=0;t<this.elements.length;t+=1)this.elements[t].addEventListener("keyup",this.checkSelectionWrapper),this.elements[t].addEventListener("blur",this.checkSelectionWrapper);return this},checkSelection:function(){var e,n;return this.keepToolbarAlive===!0||this.options.disableToolbar||(e=t.getSelection(),""===e.toString().trim()||this.options.allowMultiParagraphSelection===!1&&this.hasMultiParagraphs()?this.hideToolbarActions():(n=this.getSelectionElement(),!n||n.getAttribute("data-disable-toolbar")?this.hideToolbarActions():this.checkSelectionElement(e,n))),this},clickingIntoArchorForm:function(t){var e=this;return t.type&&"blur"===t.type.toLowerCase()&&t.relatedTarget&&t.relatedTarget===e.anchorInput?!0:!1},hasMultiParagraphs:function(){var t=a().replace(/<[\S]+><\/[\S]+>/gim,""),e=t.match(/<(p|h[0-6]|blockquote)>([\s\S]*?)<\/(p|h[0-6]|blockquote)>/g);return e?e.length:0},checkSelectionElement:function(t,e){var n;for(this.selection=t,this.selectionRange=this.selection.getRangeAt(0),n=0;n<this.elements.length;n+=1)if(this.elements[n]===e)return void this.setToolbarButtonStates().setToolbarPosition().showToolbarActions();this.hideToolbarActions()},getSelectionElement:function(){var e,n,i,o,r=t.getSelection(),a=function(t){var e=t;try{for(;!e.getAttribute("data-medium-element");)e=e.parentNode}catch(n){return!1}return e};try{e=r.getRangeAt(0),n=e.commonAncestorContainer,i=n.parentNode,o=n.getAttribute("data-medium-element")?n:a(i)}catch(s){o=a(i)}return o},setToolbarPosition:function(){var e=50,n=t.getSelection(),i=n.getRangeAt(0),o=i.getBoundingClientRect(),r=this.options.diffLeft-this.toolbar.offsetWidth/2,a=(o.left+o.right)/2,s=this.toolbar.offsetWidth/2;return o.top<e?(this.toolbar.classList.add("medium-toolbar-arrow-over"),this.toolbar.classList.remove("medium-toolbar-arrow-under"),this.toolbar.style.top=e+o.bottom-this.options.diffTop+t.pageYOffset-this.toolbar.offsetHeight+"px"):(this.toolbar.classList.add("medium-toolbar-arrow-under"),this.toolbar.classList.remove("medium-toolbar-arrow-over"),this.toolbar.style.top=o.top+this.options.diffTop+t.pageYOffset-this.toolbar.offsetHeight+"px"),this.toolbar.style.left=s>a?r+s+"px":t.innerWidth-a<s?t.innerWidth+r-s+"px":r+a+"px",this.hideAnchorPreview(),this},setToolbarButtonStates:function(){var t,e=this.toolbarActions.querySelectorAll("button");for(t=0;t<e.length;t+=1)e[t].classList.remove("medium-editor-button-active");return this.checkActiveButtons(),this},checkActiveButtons:function(){var t=Array.prototype.slice.call(this.elements),e=this.selection.anchorNode;for(e.tagName||(e=this.selection.anchorNode.parentNode);void 0!==e.tagName&&-1===this.parentElements.indexOf(e.tagName.toLowerCase)&&(this.activateButton(e.tagName.toLowerCase()),this.callExtensions("checkState",e),-1===t.indexOf(e));)e=e.parentNode},activateButton:function(t){var e=this.toolbar.querySelector('[data-element="'+t+'"]');null!==e&&-1===e.className.indexOf("medium-editor-button-active")&&(e.className+=" medium-editor-button-active")},bindButtons:function(){var t,e=this.toolbar.querySelectorAll("button"),n=this,i=function(t){t.preventDefault(),t.stopPropagation(),void 0===n.selection&&n.checkSelection(),this.className.indexOf("medium-editor-button-active")>-1?this.classList.remove("medium-editor-button-active"):this.className+=" medium-editor-button-active",this.hasAttribute("data-action")&&n.execAction(this.getAttribute("data-action"),t)};for(t=0;t<e.length;t+=1)e[t].addEventListener("click",i);return this.setFirstAndLastItems(e),this},setFirstAndLastItems:function(t){return t.length>0&&(t[0].className+=" medium-editor-button-first",t[t.length-1].className+=" medium-editor-button-last"),this},execAction:function(n,i){n.indexOf("append-")>-1?(this.execFormatBlock(n.replace("append-","")),this.setToolbarPosition(),this.setToolbarButtonStates()):"anchor"===n?this.triggerAnchorAction(i):"image"===n?e.execCommand("insertImage",!1,t.getSelection()):(e.execCommand(n,!1,null),this.setToolbarPosition())},triggerAnchorAction:function(){return"a"===this.selection.anchorNode.parentNode.tagName.toLowerCase()?e.execCommand("unlink",!1,null):"block"===this.anchorForm.style.display?this.showToolbarActions():this.showAnchorForm(),this},execFormatBlock:function(t){var n=this.getSelectionData(this.selection.anchorNode);if("blockquote"===t&&n.el&&"blockquote"===n.el.parentNode.tagName.toLowerCase())return e.execCommand("outdent",!1,null);if(n.tagName===t&&(t="p"),this.isIE){if("blockquote"===t)return e.execCommand("indent",!1,t);t="<"+t+">"}return e.execCommand("formatBlock",!1,t)},getSelectionData:function(t){var e;for(t&&t.tagName&&(e=t.tagName.toLowerCase());t&&-1===this.parentElements.indexOf(e);)t=t.parentNode,t&&t.tagName&&(e=t.tagName.toLowerCase());return{el:t,tagName:e}},getFirstChild:function(t){for(var e=t.firstChild;null!==e&&1!==e.nodeType;)e=e.nextSibling;return e},hideToolbarActions:function(){this.keepToolbarAlive=!1,void 0!==this.toolbar&&this.toolbar.classList.remove("medium-editor-toolbar-active")},showToolbarActions:function(){var t,e=this;this.anchorForm.style.display="none",this.toolbarActions.style.display="block",this.keepToolbarAlive=!1,clearTimeout(t),t=setTimeout(function(){e.toolbar&&!e.toolbar.classList.contains("medium-editor-toolbar-active")&&e.toolbar.classList.add("medium-editor-toolbar-active")},100)},showAnchorForm:function(t){this.toolbarActions.style.display="none",this.savedSelection=i(),this.anchorForm.style.display="block",this.keepToolbarAlive=!0,this.anchorInput.focus(),this.anchorInput.value=t||""},bindAnchorForm:function(){var t=this.anchorForm.querySelector("a"),e=this;return this.anchorForm.addEventListener("click",function(t){t.stopPropagation()}),this.anchorInput.addEventListener("keyup",function(t){13===t.keyCode&&(t.preventDefault(),e.createLink(this))}),this.anchorInput.addEventListener("click",function(t){t.stopPropagation(),e.keepToolbarAlive=!0}),this.anchorInput.addEventListener("blur",function(){e.keepToolbarAlive=!1,e.checkSelection()}),t.addEventListener("click",function(t){t.preventDefault(),e.showToolbarActions(),o(e.savedSelection)}),this},hideAnchorPreview:function(){this.anchorPreview.classList.remove("medium-editor-anchor-preview-active")},showAnchorPreview:function(e){if(this.anchorPreview.classList.contains("medium-editor-anchor-preview-active"))return!0;var n,i,o,r=this,a=40,s=e.getBoundingClientRect(),c=(s.left+s.right)/2;return r.anchorPreview.querySelector("i").innerHTML=e.href,n=r.anchorPreview.offsetWidth/2,i=r.options.diffLeft-n,clearTimeout(o),o=setTimeout(function(){r.anchorPreview&&!r.anchorPreview.classList.contains("medium-editor-anchor-preview-active")&&r.anchorPreview.classList.add("medium-editor-anchor-preview-active")},100),r.observeAnchorPreview(e),r.anchorPreview.classList.add("medium-toolbar-arrow-over"),r.anchorPreview.classList.remove("medium-toolbar-arrow-under"),r.anchorPreview.style.top=Math.round(a+s.bottom-r.options.diffTop+t.pageYOffset-r.anchorPreview.offsetHeight)+"px",r.anchorPreview.style.left=n>c?i+n+"px":t.innerWidth-c<n?t.innerWidth+i-n+"px":i+c+"px",this},observeAnchorPreview:function(t){var e=this,n=(new Date).getTime(),i=!0,o=function(){n=(new Date).getTime(),i=!0},r=function(t){t.relatedTarget&&/anchor-preview/.test(t.relatedTarget.className)||(i=!1)},a=setInterval(function(){if(i)return!0;var s=(new Date).getTime()-n;s>e.options.anchorPreviewHideDelay&&(e.hideAnchorPreview(),clearInterval(a),e.anchorPreview.removeEventListener("mouseover",o),e.anchorPreview.removeEventListener("mouseout",r),t.removeEventListener("mouseover",o),t.removeEventListener("mouseout",r))},200);e.anchorPreview.addEventListener("mouseover",o),e.anchorPreview.addEventListener("mouseout",r),t.addEventListener("mouseover",o),t.addEventListener("mouseout",r)},createAnchorPreview:function(){var t=this,n=e.createElement("div");return n.id="medium-editor-anchor-preview-"+this.id,n.className="medium-editor-anchor-preview",n.innerHTML=this.anchorPreviewTemplate(),e.body.appendChild(n),n.addEventListener("click",function(){t.anchorPreviewClickHandler()}),n},anchorPreviewTemplate:function(){return'<div class="medium-editor-toolbar-anchor-preview" id="medium-editor-toolbar-anchor-preview">    <i class="medium-editor-toolbar-anchor-preview-inner"></i></div>'},anchorPreviewClickHandler:function(){if(this.activeAnchor){var n=this,i=e.createRange(),o=t.getSelection();i.selectNodeContents(n.activeAnchor),o.removeAllRanges(),o.addRange(i),setTimeout(function(){n.activeAnchor&&n.showAnchorForm(n.activeAnchor.href),n.keepToolbarAlive=!1},100+n.options.delay)}this.hideAnchorPreview()},editorAnchorObserver:function(t){var e=this,n=!0,i=function(){n=!1,e.activeAnchor.removeEventListener("mouseout",i)};if(t.target&&"a"===t.target.tagName.toLowerCase()){if(!/href=["']\S+["']/.test(t.target.outerHTML)||/href=["']#\S+["']/.test(t.target.outerHTML))return!0;if(this.toolbar.classList.contains("medium-editor-toolbar-active"))return!0;this.activeAnchor=t.target,this.activeAnchor.addEventListener("mouseout",i),setTimeout(function(){n&&e.showAnchorPreview(t.target)},e.options.delay)}},bindAnchorPreview:function(){var t,e=this;for(this.editorAnchorObserverWrapper=function(t){e.editorAnchorObserver(t)},t=0;t<this.elements.length;t+=1)this.elements[t].addEventListener("mouseover",this.editorAnchorObserverWrapper);return this},checkLinkFormat:function(t){var e=/^https?:\/\//;return t.match(e)?t:"http://"+t},setTargetBlank:function(){var t,e=r();if("a"===e.tagName.toLowerCase())e.target="_blank";else for(e=e.getElementsByTagName("a"),t=0;t<e.length;t+=1)e[t].target="_blank"},createLink:function(t){o(this.savedSelection),this.options.checkLinkFormat&&(t.value=this.checkLinkFormat(t.value)),e.execCommand("createLink",!1,t.value),this.options.targetBlank&&this.setTargetBlank(),this.showToolbarActions(),t.value=""},bindWindowActions:function(){var e,n=this;return this.windowResizeHandler=function(){clearTimeout(e),e=setTimeout(function(){n.toolbar&&n.toolbar.classList.contains("medium-editor-toolbar-active")&&n.setToolbarPosition()},100)},t.addEventListener("resize",this.windowResizeHandler),this},activate:function(){this.isActive||this.setup()},deactivate:function(){var n;if(this.isActive)for(this.isActive=!1,void 0!==this.toolbar&&(e.body.removeChild(this.anchorPreview),e.body.removeChild(this.toolbar),delete this.toolbar,delete this.anchorPreview),e.documentElement.removeEventListener("mouseup",this.checkSelectionWrapper),t.removeEventListener("resize",this.windowResizeHandler),n=0;n<this.elements.length;n+=1)this.elements[n].removeEventListener("mouseover",this.editorAnchorObserverWrapper),this.elements[n].removeEventListener("keyup",this.checkSelectionWrapper),this.elements[n].removeEventListener("blur",this.checkSelectionWrapper),this.elements[n].removeEventListener("paste",this.pasteWrapper),this.elements[n].removeAttribute("contentEditable"),this.elements[n].removeAttribute("data-medium-element")},htmlEntities:function(t){return String(t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},bindPaste:function(){var t,n=this;for(this.pasteWrapper=function(t){var i,o,r="";if(this.classList.remove("medium-editor-placeholder"),!n.options.forcePlainText&&!n.options.cleanPastedHTML)return this;if(t.clipboardData&&t.clipboardData.getData&&!t.defaultPrevented){if(t.preventDefault(),n.options.cleanPastedHTML&&t.clipboardData.getData("text/html"))return n.cleanPaste(t.clipboardData.getData("text/html"));if(n.options.disableReturn)e.execCommand("insertHTML",!1,t.clipboardData.getData("text/plain"));else{for(i=t.clipboardData.getData("text/plain").split(/[\r\n]/g),o=0;o<i.length;o+=1)""!==i[o]&&(r+=navigator.userAgent.match(/firefox/i)&&0===o?n.htmlEntities(i[o]):"<p>"+n.htmlEntities(i[o])+"</p>");e.execCommand("insertHTML",!1,r)}}},t=0;t<this.elements.length;t+=1)this.elements[t].addEventListener("paste",this.pasteWrapper);return this},setPlaceholders:function(){var t,e=function(t){""===t.textContent.replace(/^\s+|\s+$/g,"")&&t.classList.add("medium-editor-placeholder")},n=function(t){this.classList.remove("medium-editor-placeholder"),"keypress"!==t.type&&e(this)};for(t=0;t<this.elements.length;t+=1)e(this.elements[t]),this.elements[t].addEventListener("blur",n),this.elements[t].addEventListener("keypress",n);return this},cleanPaste:function(t){var n,i,o,r=this.getSelectionElement(),a=/<p|<br|<div/.test(t),s=[[new RegExp(/<[^>]*docs-internal-guid[^>]*>/gi),""],[new RegExp(/<\/b>(<br[^>]*>)?$/gi),""],[new RegExp(/<span class="Apple-converted-space">\s+<\/span>/g)," "],[new RegExp(/<br class="Apple-interchange-newline">/g),"<br>"],[new RegExp(/<span[^>]*(font-style:italic;font-weight:bold|font-weight:bold;font-style:italic)[^>]*>/gi),'<span class="replace-with italic bold">'],[new RegExp(/<span[^>]*font-style:italic[^>]*>/gi),'<span class="replace-with italic">'],[new RegExp(/<span[^>]*font-weight:bold[^>]*>/gi),'<span class="replace-with bold">'],[new RegExp(/&lt;(\/?)(i|b|a)&gt;/gi),"<$1$2>"],[new RegExp(/&lt;a\s+href=(&quot;|&rdquo;|&ldquo;||)([^&]+)(&quot;|&rdquo;|&ldquo;||)&gt;/gi),'<a href="$2">']];for(n=0;n<s.length;n+=1)t=t.replace(s[n][0],s[n][1]);if(a)for(i=t.split("<br><br>"),this.pasteHTML("<p>"+i.join("</p><p>")+"</p>"),e.execCommand("insertText",!1,"\n"),i=r.querySelectorAll("p,div,br"),n=0;n<i.length;n+=1)switch(o=i[n],o.tagName.toLowerCase()){case"p":case"div":this.filterCommonBlocks(o);break;case"br":this.filterLineBreak(o)}else this.pasteHTML(t)},pasteHTML:function(t){var n,i,o,r,a=e.createDocumentFragment();for(a.appendChild(e.createElement("body")),r=a.querySelector("body"),r.innerHTML=t,this.cleanupSpans(r),n=r.querySelectorAll("*"),o=0;o<n.length;o+=1)i=n[o],i.removeAttribute("class"),i.removeAttribute("style"),i.removeAttribute("dir"),"meta"===i.tagName.toLowerCase()&&i.parentNode.removeChild(i);e.execCommand("insertHTML",!1,r.innerHTML.replace(/&nbsp;/g," "))},isCommonBlock:function(t){return t&&("p"===t.tagName.toLowerCase()||"div"===t.tagName.toLowerCase())},filterCommonBlocks:function(t){/^\s*$/.test(t.innerText)&&t.parentNode.removeChild(t)},filterLineBreak:function(t){this.isCommonBlock(t.previousElementSibling)?t.parentNode.removeChild(t):!this.isCommonBlock(t.parentNode)||t.parentNode.firstChild!==t&&t.parentNode.lastChild!==t?1===t.parentNode.childElementCount&&this.removeWithParent(t):t.parentNode.removeChild(t)},removeWithParent:function(t){t&&t.parentNode&&(t.parentNode.parentNode&&1===t.parentNode.childElementCount?t.parentNode.parentNode.removeChild(t.parentNode):t.parentNode.removeChild(t.parentNode))},cleanupSpans:function(t){var n,i,o,r=t.querySelectorAll(".replace-with");for(n=0;n<r.length;n+=1)i=r[n],o=e.createElement(i.classList.contains("bold")?"b":"i"),o.innerHTML=i.classList.contains("bold")&&i.classList.contains("italic")?"<i>"+i.innerHTML+"</i>":i.innerHTML,i.parentNode.replaceChild(o,i);for(r=t.querySelectorAll("span"),n=0;n<r.length;n+=1)i=r[n],/^\s*$/.test()?i.parentNode.removeChild(i):i.parentNode.replaceChild(e.createTextNode(i.innerText),i)}}}(window,document),angular.module("angular-medium-editor",[]).directive("mediumEditor",function(){return{require:"ngModel",restrict:"AE",link:function(t,e,n,i){angular.element(e).addClass("angular-medium-editor");var o={};n.options&&(o=angular.fromJson(n.options));var r=o.placeholder||"Type your text",a=function(){t.$apply(function(){if("<p><br></p>"==e.html()){o.placeholder=r;{new MediumEditor(e,o)}}i.$setViewValue(e.html())})};e.on("blur",a),e.on("input",a),i.$render=function(){if(!t){i.$isEmpty(i.$viewValue)||(o.placeholder="");var t=new MediumEditor(e,o)}e.html(i.$isEmpty(i.$viewValue)?"":i.$viewValue)}}}});